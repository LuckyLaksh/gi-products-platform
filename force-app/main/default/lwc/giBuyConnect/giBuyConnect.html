<template>
    <lightning-card title="Buy or Connect" icon-name="standard:opportunity">
        <div class="slds-p-around_medium">
            <template if:true={isLoading}>
                <lightning-spinner alternative-text="Loading..."></lightning-spinner>
            </template>

            <template if:false={isLoading}>
                <template if:true={product}>
                    <div class="slds-m-bottom_medium">
                        <h3 class="slds-text-heading_medium">{product.Name}</h3>
                        <p class="slds-text-body_small slds-text-color_weak">{product.Description}</p>
                    </div>

                    <!-- Available Sellers -->
                    <template if:true={hasSellers}>
                        <div class="slds-m-bottom_medium">
                            <h4 class="slds-text-heading_small slds-m-bottom_small">Available Sellers:</h4>
                            <template for:each={sellers} for:item="seller">
                                <div key={seller.Id} class="slds-box slds-m-bottom_small">
                                    <div class="slds-grid slds-grid_align-spread">
                                        <div>
                                            <p class="slds-text-heading_small">{seller.Name}</p>
                                            <template if:true={seller.Seller_Rating__c}>
                                                <p class="slds-text-body_small">
                                                    <lightning-icon icon-name="utility:favorite" size="x-small" class="slds-icon-text-warning"></lightning-icon>
                                                    {seller.Seller_Rating__c}/5.0
                                                </p>
                                            </template>
                                            <template if:true={seller.Email}>
                                                <p class="slds-text-body_small">
                                                    <lightning-icon icon-name="utility:email" size="x-small" class="slds-m-right_xx-small"></lightning-icon>
                                                    {seller.Email}
                                                </p>
                                            </template>
                                            <template if:true={seller.Phone}>
                                                <p class="slds-text-body_small">
                                                    <lightning-icon icon-name="utility:phone_portrait" size="x-small" class="slds-m-right_xx-small"></lightning-icon>
                                                    {seller.Phone}
                                                </p>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </template>

                    <!-- Connect Form -->
                    <template if:false={showForm}>
                        <lightning-button
                            label="Connect with Seller"
                            variant="brand"
                            onclick={handleShowForm}
                            class="slds-m-top_medium">
                        </lightning-button>
                    </template>

                    <template if:true={showForm}>
                        <div class="slds-box slds-m-top_medium">
                            <h4 class="slds-text-heading_small slds-m-bottom_small">Submit Inquiry</h4>
                            
                            <template if:true={hasSellers}>
                                <lightning-combobox
                                    label="Select Seller"
                                    value={contactId}
                                    options={sellerOptions}
                                    onchange={handleContactChange}
                                    class="slds-m-bottom_small">
                                </lightning-combobox>
                            </template>

                            <lightning-input
                                type="text"
                                label="Inquiry Name"
                                value={opportunityName}
                                onchange={handleNameChange}
                                class="slds-m-bottom_small">
                            </lightning-input>

                            <lightning-input
                                type="number"
                                label="Estimated Amount (Optional)"
                                value={amount}
                                onchange={handleAmountChange}
                                class="slds-m-bottom_small">
                            </lightning-input>

                            <lightning-input
                                type="date"
                                label="Expected Close Date (Optional)"
                                value={closeDate}
                                onchange={handleDateChange}
                                class="slds-m-bottom_small">
                            </lightning-input>

                            <div class="slds-m-top_medium">
                                <lightning-button
                                    label="Submit"
                                    variant="brand"
                                    onclick={handleSubmit}
                                    class="slds-m-right_small">
                                </lightning-button>
                                <lightning-button
                                    label="Cancel"
                                    onclick={handleCancel}>
                                </lightning-button>
                            </div>
                        </div>
                    </template>
                </template>

                <template if:false={product}>
                    <p class="slds-text-body_regular">Please select a product to view buying options.</p>
                </template>
            </template>
        </div>
    </lightning-card>
</template>

